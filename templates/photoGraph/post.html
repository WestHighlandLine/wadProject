{% extends 'photoGraph/base.html' %}
{% load staticfiles %}
{% load template_tags %}

{% block title_block %}
    {{ post.created_by }}'s Post
{% endblock %}

{% block custom_head %}
	<link rel="stylesheet" type="text/css" href="{% static 'view_post.css' %}">


    <script>   
    $(document).ready(function() {
        $('#like_btn').click(function() {
            var postIDvar;
            $('#like_btn').hide();
            postIDvar = $(this).attr('data-postid');
            $.get('/photoGraph/like_category/',
            {'post_id': postIDvar},
            function(data) {
                $('#like_count').html(data);
                
            })
            
        });
    });
    </script>
{% endblock %}

{% block body_block %}
    <div class="post-title-container">
        <span class="post-title">{{ post.caption }}</span> at <a href="{% url 'main:show_location' %}?location_name={{ post.location_name }}">{{ post.location_name }}</a>
    </div>
    <div class="post-inner">
        <span class="post-info-primary">Posted by: <a href="{% url 'main:show_user_profile' post.created_by.slug %}">{{ post.created_by.slug }}</a></span><br/>
        <span class="post-info-secondary"><span id="like_count">{% get_likes post %}</span> likes, taken {{post.created_time}}</span>
        <br>
        {% if user.is_authenticated and not has_user_liked %}
            <button id="like_btn" data-postid="{{ post.id }}" class="btn btn-primary btn-sm" type="button">
                <span data-feather="thumbs-up"></span>
                Like
            </button>
        {% endif %}
        <a href="{% url 'main:report_post' post.id %}" class="report-link">Report this post</a>
    </div>
    <div class="post-container">
        <a href="{{ post.photo.url }}" target="_blank" class="post-photo-link"><img src="{{ post.photo.url }}" class="post-photo" /></a><br/>
        <div id="map"></div>
    </div>

    <br>

    {% if comments %}
        {% comment_template comments %}
    {% else %}
        <p>This post has received no comments. Be the first to comment!</p>
    {% endif %}

    <script>
        function setupMap() {
            try {
                map = L.map('map').setView(["{{ post.latitude }}", "{{ post.longitude }}"], 17);

                L.tileLayer('https://tile.openstreetmap.org/{z}/{x}/{y}.png', {
                    attribution: '&copy; <a href="https://www.openstreetmap.org/copyright">OpenStreetMap</a> contributors'
                }).addTo(map);

                L.marker(["{{ post.latitude }}", "{{ post.longitude }}"], {
                    icon: new L.DivIcon({
                        className: "custom-marker-icon",
                        html: `<img src="{{post.photo.url}}"/>`,
                        iconSize: [70, 70],
                        iconAnchor: [35, 0],
                        popupAnchor: [0, 0]
                    })
                }).addTo(map);
            } catch (e) { throw e;}
        }
        setupMap();
    </script>
{% endblock %}